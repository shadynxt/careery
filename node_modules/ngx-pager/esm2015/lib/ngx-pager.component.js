/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { Router, ActivatedRoute } from '@angular/router';
export class NgxPagerComponent {
    /* Function Name : constructor
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to define the all helpful objects and defin the languages data
        * PARAMS : cService, modalService, translate
        */
    /**
     * @param {?} route
     * @param {?} activeRoute
     */
    constructor(route, activeRoute) {
        this.route = route;
        this.activeRoute = activeRoute;
        this.config = null; // set the config
        // set the config
        this.totalrow = null;
        // @Output('page') page = new EventEmitter();
        this.pages = []; // get pages
        // get pages
        this.currentPage = 1; // for current page no
        // for current page no
        this.displayPagesCount = 3; // set no of display page 
        // set no of display page 
        this.totalPage = 1; // get the total page
        // get the total page
        this.simple = false; // to set only next and prev link
        // to set only next and prev link
        this.firstLastView = false; // to set that last first button will display or not
        // to set that last first button will display or not
        this.error = false;
        this.redirectType = '';
        this.redirectParamName = '';
        this.customContent = {
            "prev": "&#10094;",
            "next": "&#x276F;",
            "first": "&#10094;&#10094;",
            "last": "&#x276F;&#x276F;",
        };
    }
    /* Function Name : ngOnInit
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to get data after html load
        * PARAMS :
        */
    /**
     * @return {?}
     */
    ngOnInit() {
        if (localStorage.getItem('_nxp') && this.config && !this.config.redirect) {
            /** @type {?} */
            let localUrl = localStorage.getItem('_nxp');
            /** @type {?} */
            let localUrlArr = localUrl.split(":");
            if (localUrlArr[0] == this.route.url) {
                this.currentPage = Number(localUrlArr[1]);
            }
            this.rendering();
        }
        else if (!localStorage.getItem('_nxp') && this.config && !this.config.redirect) {
            localStorage.setItem('_nxp', this.route.url + ':' + this.currentPage);
            this.rendering();
        }
        else if (this.totalrow || this.totalrow == 0) {
            this.error = true;
        }
        else if (this.config && this.config.redirect) {
            localStorage.removeItem("_nxp");
            if (!this.config.redirect.type) {
                console.error("'type' parameter must be set with 'redirect' parameter");
                this.error = true;
                return false;
            }
            if (!this.config.redirect.param) {
                console.error("'param' parameter must be set with 'redirect' parameter");
                this.error = true;
                return false;
            }
            if (!this.error) {
                /** @type {?} */
                let activeRouteObj = null;
                if (this.config.redirect.type === 'q') { // query string
                    activeRouteObj = this.activeRoute.queryParams;
                    this.redirectParamName = this.config.redirect.param;
                }
                else if (this.config.redirect.type === 'p') { // query parameters
                    this.redirectParamName = this.config.redirect.param.name;
                    activeRouteObj = this.activeRoute.params;
                }
                activeRouteObj.subscribe((/**
                 * @param {?} params
                 * @return {?}
                 */
                params => {
                    if (params[this.redirectParamName]) {
                        this.currentPage = parseInt(params[this.redirectParamName]);
                    }
                    this.rendering();
                }));
            }
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.totalrow && this.totalrow) {
            this.settings();
        }
    }
    /**
     * @return {?}
     */
    settings() {
        if (this.config) {
            if (this.config.firstLastView) {
                this.firstLastView = this.config.firstLastView;
            }
            if (this.config.simple) {
                this.simple = this.config.simple;
            }
            if (this.config.displayPageCount) {
                this.displayPagesCount = this.config.displayPageCount;
            }
            if (this.config.customContent) {
                if (this.config.customContent.prev) {
                    this.customContent.prev = this.config.customContent.prev;
                }
                if (this.config.customContent.next) {
                    this.customContent.next = this.config.customContent.next;
                }
                if (this.config.customContent.first) {
                    this.customContent.first = this.config.customContent.first;
                }
                if (this.config.customContent.last) {
                    this.customContent.last = this.config.customContent.last;
                }
            }
            if (this.error === false && this.totalrow && this.config.perPage) {
                this.totalPage = this.totalrow / this.config.perPage;
                if (this.totalPage % 1 != 0) {
                    this.totalPage += 1;
                    this.totalPage = Math.floor(this.totalPage);
                }
            }
            else {
                if (!this.totalrow) {
                    console.error("'totalrow' parameter must be set");
                    this.error = true;
                    // return false;
                }
                if (!this.config.perPage) {
                    console.error("'perPage' parameter must be set");
                    this.error = true;
                    // return false;
                }
            }
            if (this.error === false && this.displayPagesCount > this.totalPage) {
                this.displayPagesCount = this.totalPage;
            }
            if (this.error === false) {
                this.redefinePager();
            }
        }
        else {
            console.error("define 'config' parameters of ngx-pager");
            this.error = true;
            return false;
        }
    }
    /* Function Name : pageClick
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : event for click on page
        * PARAMS : pageNo
        */
    /**
     * @param {?} event
     * @param {?} pageNo
     * @return {?}
     */
    pageClick(event, pageNo) {
        this.currentPage = pageNo;
        // console.log(this.currentPage);
        this.redefinePager();
        if (!this.config.redirect) {
            localStorage.setItem('_nxp', this.route.url + ':' + this.currentPage);
            this.rendering();
        }
        else {
            /** @type {?} */
            let navigateConfig = {
                relativeTo: this.activeRoute
            };
            if (this.config.redirect.type === 'q') {
                navigateConfig['queryParams'] = {};
                navigateConfig['queryParams'][this.redirectParamName] = this.currentPage;
                navigateConfig['queryParamsHandling'] = 'merge';
                this.route.navigate([], navigateConfig);
            }
            else if (this.config.redirect.type === 'p') {
                if (this.config.redirect.param.path) {
                    /** @type {?} */
                    let navigate = [this.config.redirect.param.path];
                    for (let p in this.config.redirect.param.params) {
                        if (p === this.redirectParamName) {
                            navigate.push(this.currentPage);
                        }
                        else {
                            navigate.push(this.config.redirect.param.params[p]);
                        }
                    }
                    this.route.navigate(navigate);
                }
                else {
                    console.error("'url' parameter must be set with 'config.redirect'");
                    this.error = true;
                    return false;
                }
            }
        }
    }
    /* Function Name : redefinePager
        * Author :
        * Created Date : 06-03-2019
        * Modified Date : *
        * Purpose : to create pagination html
        * PARAMS :
        */
    /**
     * @return {?}
     */
    redefinePager() {
        this.pages = [];
        this.pages.push(this.currentPage);
        /** @type {?} */
        let leftCount = 0;
        /** @type {?} */
        let rightCount = 0;
        if (this.displayPagesCount % 2 == 0) { // if even display number count
            leftCount = Math.floor(this.displayPagesCount / 3); // one thard in left
            rightCount = Math.floor((this.displayPagesCount * 2) / 3); // two thard in right
            if (this.displayPagesCount % 6 == 0) {
                leftCount -= 1;
            }
        }
        else { // if odd display number count 
            leftCount = Math.floor((this.displayPagesCount - 1) / 2); // half in left
            rightCount = Math.floor((this.displayPagesCount - 1) / 2); // half in right
        }
        /** @type {?} */
        let leftArr = [];
        /** @type {?} */
        let rightArr = [];
        for (let p = 1; p <= leftCount; p++) {
            if ((this.currentPage - p) > 0) {
                leftArr.push(this.currentPage - p);
            }
        }
        if (leftArr.length < leftCount) {
            rightCount += leftCount - leftArr.length;
        }
        for (let p = 1; p <= rightCount; p++) {
            if (this.currentPage + p <= this.totalPage) {
                rightArr.push(this.currentPage + p);
            }
        }
        if (rightArr.length < rightCount) {
            leftCount += rightCount - rightArr.length;
            leftArr = [];
            for (let p = 1; p <= leftCount; p++) {
                if ((this.currentPage - p) > 0) {
                    leftArr.push(this.currentPage - p);
                }
            }
        }
        this.pages = this.pages.concat(leftArr);
        this.pages = this.pages.concat(rightArr);
        this.pages.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => a - b));
    }
    /**
     * @return {?}
     */
    rendering() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.config.render(this.currentPage);
        }), 5);
    }
}
NgxPagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-pager',
                template: "<div class=\"ngx-pager-container\" *ngIf=\"!error && totalrow > 0\">\n<ul *ngIf=\"pages\">\n    <li class=\"arrow first\" [class.disabled]=\"currentPage==1\" *ngIf=\"firstLastView && !simple\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, 1)\" [innerHTML]=\"customContent.first\"></a></li>\n    \n    <li class=\"arrow prev\" [class.disabled]=\"currentPage==1\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, (currentPage-1))\" [innerHTML]=\"customContent.prev\"></a></li>\n    \n    <li *ngFor=\"let p of pages\" [class.active]=\"currentPage==p\" [class.invisible]=\"simple\">\n    <a  href=\"javascript:void(0)\" (click)=\"pageClick($event, p)\">{{ p }}</a>\n    </li>\n    \n    <li class=\"arrow next\" [class.disabled]=\"currentPage==totalPage\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, currentPage+1)\" [innerHTML]=\"customContent.next\"></a></li>\n    \n    <li class=\"arrow last\" [class.disabled]=\"currentPage==totalPage\" *ngIf=\"firstLastView && !simple\"><a  href=\"javascript:void(0)\" (click)=\"pageClick($event, totalPage)\" [innerHTML]=\"customContent.last\"></a></li>\n</ul>\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
NgxPagerComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute }
];
NgxPagerComponent.propDecorators = {
    config: [{ type: Input }],
    totalrow: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgxPagerComponent.prototype.config;
    /** @type {?} */
    NgxPagerComponent.prototype.totalrow;
    /** @type {?} */
    NgxPagerComponent.prototype.pages;
    /** @type {?} */
    NgxPagerComponent.prototype.currentPage;
    /** @type {?} */
    NgxPagerComponent.prototype.displayPagesCount;
    /** @type {?} */
    NgxPagerComponent.prototype.totalPage;
    /** @type {?} */
    NgxPagerComponent.prototype.simple;
    /** @type {?} */
    NgxPagerComponent.prototype.firstLastView;
    /** @type {?} */
    NgxPagerComponent.prototype.error;
    /** @type {?} */
    NgxPagerComponent.prototype.redirectType;
    /** @type {?} */
    NgxPagerComponent.prototype.redirectParamName;
    /** @type {?} */
    NgxPagerComponent.prototype.customContent;
    /**
     * @type {?}
     * @private
     */
    NgxPagerComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    NgxPagerComponent.prototype.activeRoute;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBhZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1wYWdlci8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtcGFnZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFXLEtBQUssRUFBMEMsTUFBTSxlQUFlLENBQUM7QUFDbEcsT0FBTyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQU16RCxNQUFNLE9BQU8saUJBQWlCOzs7Ozs7Ozs7Ozs7SUE4QjVCLFlBQW9CLEtBQWEsRUFBVSxXQUEyQjtRQUFsRCxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBNUI3RCxXQUFNLEdBQVEsSUFBSSxDQUFDLENBQUMsaUJBQWlCOztRQUNyQyxhQUFRLEdBQUcsSUFBSSxDQUFDOztRQUV6QixVQUFLLEdBQWdCLEVBQUUsQ0FBQyxDQUFDLFlBQVk7O1FBQ3JDLGdCQUFXLEdBQVksQ0FBQyxDQUFDLENBQUMsc0JBQXNCOztRQUNoRCxzQkFBaUIsR0FBVyxDQUFDLENBQUMsQ0FBQywwQkFBMEI7O1FBQ3pELGNBQVMsR0FBVyxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7O1FBQzVDLFdBQU0sR0FBVyxLQUFLLENBQUMsQ0FBQyxpQ0FBaUM7O1FBQ3pELGtCQUFhLEdBQVksS0FBSyxDQUFDLENBQUMsb0RBQW9EOztRQUNwRixVQUFLLEdBQWEsS0FBSyxDQUFDO1FBQ3hCLGlCQUFZLEdBQVcsRUFBRSxDQUFDO1FBQzFCLHNCQUFpQixHQUFXLEVBQUUsQ0FBQztRQUUvQixrQkFBYSxHQUFRO1lBQ25CLE1BQU0sRUFBQyxVQUFVO1lBQ2pCLE1BQU0sRUFBQyxVQUFVO1lBQ2pCLE9BQU8sRUFBQyxrQkFBa0I7WUFDMUIsTUFBTSxFQUFDLGtCQUFrQjtTQUMxQixDQUFBO0lBVXdFLENBQUM7Ozs7Ozs7Ozs7O0lBUTFFLFFBQVE7UUFF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LEdBQUMsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDOzs7WUF4UUYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxXQUFXO2dCQUNyQix5b0NBQXdDOzthQUV6Qzs7OztZQUxRLE1BQU07WUFBRSxjQUFjOzs7cUJBUTVCLEtBQUs7dUJBQ0wsS0FBSzs7OztJQUROLG1DQUE0Qjs7SUFDNUIscUNBQXlCOztJQUV6QixrQ0FBd0I7O0lBQ3hCLHdDQUF5Qjs7SUFDekIsOENBQThCOztJQUM5QixzQ0FBc0I7O0lBQ3RCLG1DQUF1Qjs7SUFDdkIsMENBQStCOztJQUMvQixrQ0FBd0I7O0lBQ3hCLHlDQUEwQjs7SUFDMUIsOENBQStCOztJQUUvQiwwQ0FLQzs7Ozs7SUFVVyxrQ0FBcUI7Ozs7O0lBQUUsd0NBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCAgT3V0cHV0LCBJbnB1dCwgRXZlbnRFbWl0dGVyICwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciwgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LXBhZ2VyJyxcbiAgdGVtcGxhdGVVcmw6Jy4vbmd4LXBhZ2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmd4LXBhZ2VyLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTmd4UGFnZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIGNvbmZpZzogYW55ID0gbnVsbDsgLy8gc2V0IHRoZSBjb25maWdcbiAgQElucHV0KCkgdG90YWxyb3cgPSBudWxsO1xuICAvLyBAT3V0cHV0KCdwYWdlJykgcGFnZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgcGFnZXMgOiBBcnJheTxhbnk+ID0gW107IC8vIGdldCBwYWdlc1xuICBjdXJyZW50UGFnZSA6IG51bWJlciA9IDE7IC8vIGZvciBjdXJyZW50IHBhZ2Ugbm9cbiAgZGlzcGxheVBhZ2VzQ291bnQ6IG51bWJlciA9IDM7IC8vIHNldCBubyBvZiBkaXNwbGF5IHBhZ2UgXG4gIHRvdGFsUGFnZTogbnVtYmVyID0gMTsgLy8gZ2V0IHRoZSB0b3RhbCBwYWdlXG4gIHNpbXBsZTpib29sZWFuID0gZmFsc2U7IC8vIHRvIHNldCBvbmx5IG5leHQgYW5kIHByZXYgbGlua1xuICBmaXJzdExhc3RWaWV3OiBib29sZWFuID0gZmFsc2U7IC8vIHRvIHNldCB0aGF0IGxhc3QgZmlyc3QgYnV0dG9uIHdpbGwgZGlzcGxheSBvciBub3RcbiAgZXJyb3IgOiBib29sZWFuID0gZmFsc2U7XG4gIHJlZGlyZWN0VHlwZTogc3RyaW5nID0gJyc7XG4gIHJlZGlyZWN0UGFyYW1OYW1lOiBzdHJpbmcgPSAnJztcblxuICBjdXN0b21Db250ZW50OiBhbnkgPSB7XG4gICAgXCJwcmV2XCI6XCImIzEwMDk0O1wiLFxuICAgIFwibmV4dFwiOlwiJiN4Mjc2RjtcIixcbiAgICBcImZpcnN0XCI6XCImIzEwMDk0OyYjMTAwOTQ7XCIsXG4gICAgXCJsYXN0XCI6XCImI3gyNzZGOyYjeDI3NkY7XCIsXG4gIH1cblxuXG4gIC8qIEZ1bmN0aW9uIE5hbWUgOiBjb25zdHJ1Y3RvclxuXHQqIEF1dGhvciA6IFxuXHQqIENyZWF0ZWQgRGF0ZSA6IDA2LTAzLTIwMTkgXG5cdCogTW9kaWZpZWQgRGF0ZSA6ICpcblx0KiBQdXJwb3NlIDogdG8gZGVmaW5lIHRoZSBhbGwgaGVscGZ1bCBvYmplY3RzIGFuZCBkZWZpbiB0aGUgbGFuZ3VhZ2VzIGRhdGFcblx0KiBQQVJBTVMgOiBjU2VydmljZSwgbW9kYWxTZXJ2aWNlLCB0cmFuc2xhdGVcblx0Ki9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZTogUm91dGVyLCBwcml2YXRlIGFjdGl2ZVJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge31cbiAgLyogRnVuY3Rpb24gTmFtZSA6IG5nT25Jbml0XG5cdCogQXV0aG9yIDogXG5cdCogQ3JlYXRlZCBEYXRlIDogMDYtMDMtMjAxOSBcblx0KiBNb2RpZmllZCBEYXRlIDogKlxuXHQqIFB1cnBvc2UgOiB0byBnZXQgZGF0YSBhZnRlciBodG1sIGxvYWRcblx0KiBQQVJBTVMgOiBcblx0Ki9cbiAgbmdPbkluaXQoKSB7XG4gICAgXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdfbnhwJykgJiYgdGhpcy5jb25maWcgJiYgIXRoaXMuY29uZmlnLnJlZGlyZWN0KSB7XG4gICAgICAgICAgXG4gICAgICBsZXQgbG9jYWxVcmwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnX254cCcpO1xuICAgICAgbGV0IGxvY2FsVXJsQXJyID0gbG9jYWxVcmwuc3BsaXQoXCI6XCIpO1xuICAgICAgaWYgKGxvY2FsVXJsQXJyWzBdID09IHRoaXMucm91dGUudXJsKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBOdW1iZXIobG9jYWxVcmxBcnJbMV0pO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW5kZXJpbmcoKTtcbiAgICB9IFxuICAgIGVsc2UgaWYgKCFsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnX254cCcpICYmIHRoaXMuY29uZmlnICYmICF0aGlzLmNvbmZpZy5yZWRpcmVjdCkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ19ueHAnLCB0aGlzLnJvdXRlLnVybCsnOicrdGhpcy5jdXJyZW50UGFnZSk7XG4gICAgICB0aGlzLnJlbmRlcmluZygpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLnRvdGFscm93IHx8IHRoaXMudG90YWxyb3cgPT0gMCkge1xuICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZih0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5yZWRpcmVjdCl7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcIl9ueHBcIik7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLnJlZGlyZWN0LnR5cGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIid0eXBlJyBwYXJhbWV0ZXIgbXVzdCBiZSBzZXQgd2l0aCAncmVkaXJlY3QnIHBhcmFtZXRlclwiKTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5jb25maWcucmVkaXJlY3QucGFyYW0pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIidwYXJhbScgcGFyYW1ldGVyIG11c3QgYmUgc2V0IHdpdGggJ3JlZGlyZWN0JyBwYXJhbWV0ZXJcIik7XG4gICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuZXJyb3IpIHtcbiAgICAgICAgICBsZXQgYWN0aXZlUm91dGVPYmogPSAgbnVsbDtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWcucmVkaXJlY3QudHlwZSA9PT0gJ3EnKSB7IC8vIHF1ZXJ5IHN0cmluZ1xuICAgICAgICAgICAgYWN0aXZlUm91dGVPYmogPSB0aGlzLmFjdGl2ZVJvdXRlLnF1ZXJ5UGFyYW1zO1xuICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFBhcmFtTmFtZSA9IHRoaXMuY29uZmlnLnJlZGlyZWN0LnBhcmFtO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcucmVkaXJlY3QudHlwZSA9PT0gJ3AnKSB7IC8vIHF1ZXJ5IHBhcmFtZXRlcnNcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RQYXJhbU5hbWUgPSB0aGlzLmNvbmZpZy5yZWRpcmVjdC5wYXJhbS5uYW1lO1xuICAgICAgICAgICAgYWN0aXZlUm91dGVPYmogPSB0aGlzLmFjdGl2ZVJvdXRlLnBhcmFtcztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhY3RpdmVSb3V0ZU9iai5zdWJzY3JpYmUocGFyYW1zID0+IHtcbiAgICAgICAgICAgIGlmIChwYXJhbXNbdGhpcy5yZWRpcmVjdFBhcmFtTmFtZV0pIHtcbiAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHBhcnNlSW50KHBhcmFtc1t0aGlzLnJlZGlyZWN0UGFyYW1OYW1lXSk7XG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgdGhpcy5yZW5kZXJpbmcoKTtcbiAgICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gXG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOlNpbXBsZUNoYW5nZXMpIHtcblxuICAgIGlmIChjaGFuZ2VzLnRvdGFscm93ICYmIHRoaXMudG90YWxyb3cpICB7XG4gICAgICBcbiAgICAgIHRoaXMuc2V0dGluZ3MoKTtcbiAgICB9XG4gIH1cbiAgc2V0dGluZ3MoKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnKSB7XG4gICAgICBcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5maXJzdExhc3RWaWV3KSB7XG4gICAgICAgIHRoaXMuZmlyc3RMYXN0VmlldyA9IHRoaXMuY29uZmlnLmZpcnN0TGFzdFZpZXc7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jb25maWcuc2ltcGxlKSB7XG4gICAgICAgIHRoaXMuc2ltcGxlID0gdGhpcy5jb25maWcuc2ltcGxlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29uZmlnLmRpc3BsYXlQYWdlQ291bnQpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5UGFnZXNDb3VudCA9IHRoaXMuY29uZmlnLmRpc3BsYXlQYWdlQ291bnQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50LnByZXYpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbUNvbnRlbnQucHJldiA9IHRoaXMuY29uZmlnLmN1c3RvbUNvbnRlbnQucHJldjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25maWcuY3VzdG9tQ29udGVudC5uZXh0KSB7XG4gICAgICAgICAgdGhpcy5jdXN0b21Db250ZW50Lm5leHQgPSB0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50Lm5leHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmN1c3RvbUNvbnRlbnQuZmlyc3QpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbUNvbnRlbnQuZmlyc3QgPSB0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50LmZpcnN0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5jdXN0b21Db250ZW50Lmxhc3QpIHtcbiAgICAgICAgICB0aGlzLmN1c3RvbUNvbnRlbnQubGFzdCA9IHRoaXMuY29uZmlnLmN1c3RvbUNvbnRlbnQubGFzdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAodGhpcy5lcnJvciA9PT0gZmFsc2UgJiYgdGhpcy50b3RhbHJvdyAmJiB0aGlzLmNvbmZpZy5wZXJQYWdlKSB7XG4gICAgICAgIHRoaXMudG90YWxQYWdlID0gdGhpcy50b3RhbHJvdy90aGlzLmNvbmZpZy5wZXJQYWdlO1xuICAgICAgICBpZiAodGhpcy50b3RhbFBhZ2UlMSAhPSAwKSB7XG4gICAgICAgICAgdGhpcy50b3RhbFBhZ2UgKz0xO1xuICAgICAgICAgIHRoaXMudG90YWxQYWdlID0gTWF0aC5mbG9vcih0aGlzLnRvdGFsUGFnZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghdGhpcy50b3RhbHJvdykge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCIndG90YWxyb3cnIHBhcmFtZXRlciBtdXN0IGJlIHNldFwiKTtcbiAgICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5wZXJQYWdlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIidwZXJQYWdlJyBwYXJhbWV0ZXIgbXVzdCBiZSBzZXRcIik7XG4gICAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgICAgLy8gcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICh0aGlzLmVycm9yID09PSBmYWxzZSAmJiB0aGlzLmRpc3BsYXlQYWdlc0NvdW50ID4gdGhpcy50b3RhbFBhZ2UpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5UGFnZXNDb3VudCA9IHRoaXMudG90YWxQYWdlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZXJyb3IgPT09IGZhbHNlKSB7XG4gICAgICAgIHRoaXMucmVkZWZpbmVQYWdlcigpO1xuICAgICAgfVxuICAgICBcbiAgICAgIFxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiZGVmaW5lICdjb25maWcnIHBhcmFtZXRlcnMgb2Ygbmd4LXBhZ2VyXCIpO1xuICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIC8qIEZ1bmN0aW9uIE5hbWUgOiBwYWdlQ2xpY2tcblx0KiBBdXRob3IgOiBcblx0KiBDcmVhdGVkIERhdGUgOiAwNi0wMy0yMDE5IFxuXHQqIE1vZGlmaWVkIERhdGUgOiAqXG5cdCogUHVycG9zZSA6IGV2ZW50IGZvciBjbGljayBvbiBwYWdlXG5cdCogUEFSQU1TIDogcGFnZU5vXG5cdCovXG4gIHBhZ2VDbGljayhldmVudCwgcGFnZU5vKSB7XG4gICAgdGhpcy5jdXJyZW50UGFnZSA9IHBhZ2VObztcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRQYWdlKTtcbiAgICB0aGlzLnJlZGVmaW5lUGFnZXIoKTtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnJlZGlyZWN0KSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnX254cCcsIHRoaXMucm91dGUudXJsKyc6Jyt0aGlzLmN1cnJlbnRQYWdlKTtcbiAgICAgIHRoaXMucmVuZGVyaW5nKCk7XG4gICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG5hdmlnYXRlQ29uZmlnID0ge1xuICAgICAgICByZWxhdGl2ZVRvOiB0aGlzLmFjdGl2ZVJvdXRlXG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jb25maWcucmVkaXJlY3QudHlwZSA9PT0gJ3EnKSB7XG4gICAgICAgIG5hdmlnYXRlQ29uZmlnWydxdWVyeVBhcmFtcyddID0ge307XG4gICAgICAgIG5hdmlnYXRlQ29uZmlnWydxdWVyeVBhcmFtcyddW3RoaXMucmVkaXJlY3RQYXJhbU5hbWVdID0gdGhpcy5jdXJyZW50UGFnZTtcbiAgICAgICAgbmF2aWdhdGVDb25maWdbJ3F1ZXJ5UGFyYW1zSGFuZGxpbmcnXSA9ICdtZXJnZSc7XG4gICAgICAgIHRoaXMucm91dGUubmF2aWdhdGUoW10sIG5hdmlnYXRlQ29uZmlnKTsgIFxuICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5yZWRpcmVjdC50eXBlID09PSAncCcpIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnJlZGlyZWN0LnBhcmFtLnBhdGgpIHtcbiAgICAgICAgICBsZXQgbmF2aWdhdGUgPSBbdGhpcy5jb25maWcucmVkaXJlY3QucGFyYW0ucGF0aF07XG4gICAgICAgICAgZm9yIChsZXQgcCBpbiB0aGlzLmNvbmZpZy5yZWRpcmVjdC5wYXJhbS5wYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChwPT09dGhpcy5yZWRpcmVjdFBhcmFtTmFtZSkge1xuICAgICAgICAgICAgICBuYXZpZ2F0ZS5wdXNoKHRoaXMuY3VycmVudFBhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbmF2aWdhdGUucHVzaCh0aGlzLmNvbmZpZy5yZWRpcmVjdC5wYXJhbS5wYXJhbXNbcF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnJvdXRlLm5hdmlnYXRlKG5hdmlnYXRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiJ3VybCcgcGFyYW1ldGVyIG11c3QgYmUgc2V0IHdpdGggJ2NvbmZpZy5yZWRpcmVjdCdcIik7XG4gICAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgfVxuICAgICAgXG4gICAgfVxuICB9XG4gIC8qIEZ1bmN0aW9uIE5hbWUgOiByZWRlZmluZVBhZ2VyXG5cdCogQXV0aG9yIDogXG5cdCogQ3JlYXRlZCBEYXRlIDogMDYtMDMtMjAxOSBcblx0KiBNb2RpZmllZCBEYXRlIDogKlxuXHQqIFB1cnBvc2UgOiB0byBjcmVhdGUgcGFnaW5hdGlvbiBodG1sXG5cdCogUEFSQU1TIDogXG5cdCovXG4gIHJlZGVmaW5lUGFnZXIoKSB7XG4gICAgICB0aGlzLnBhZ2VzID0gW107XG4gICAgICB0aGlzLnBhZ2VzLnB1c2godGhpcy5jdXJyZW50UGFnZSk7XG4gICAgICBsZXQgbGVmdENvdW50ID0gMDtcbiAgICAgIGxldCByaWdodENvdW50ID0gMDtcbiAgICAgIGlmICh0aGlzLmRpc3BsYXlQYWdlc0NvdW50JTIgPT0gMCkgeyAvLyBpZiBldmVuIGRpc3BsYXkgbnVtYmVyIGNvdW50XG4gICAgICAgIGxlZnRDb3VudCA9IE1hdGguZmxvb3IodGhpcy5kaXNwbGF5UGFnZXNDb3VudC8zKTsgLy8gb25lIHRoYXJkIGluIGxlZnRcbiAgICAgICAgcmlnaHRDb3VudCA9IE1hdGguZmxvb3IoKHRoaXMuZGlzcGxheVBhZ2VzQ291bnQqMikvMyk7IC8vIHR3byB0aGFyZCBpbiByaWdodFxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5UGFnZXNDb3VudCU2ID09IDApIHtcbiAgICAgICAgICBsZWZ0Q291bnQgLT0xO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgeyAvLyBpZiBvZGQgZGlzcGxheSBudW1iZXIgY291bnQgXG4gICAgICAgIGxlZnRDb3VudCA9IE1hdGguZmxvb3IoKHRoaXMuZGlzcGxheVBhZ2VzQ291bnQtMSkvMik7IC8vIGhhbGYgaW4gbGVmdFxuICAgICAgICByaWdodENvdW50ID0gTWF0aC5mbG9vcigodGhpcy5kaXNwbGF5UGFnZXNDb3VudC0xKS8yKTsgLy8gaGFsZiBpbiByaWdodFxuICAgICAgICBcbiAgICAgIH1cbiAgICAgIGxldCBsZWZ0QXJyPVtdLCByaWdodEFycj1bXTtcbiAgICAgIGZvciAobGV0IHA9MTsgcDw9bGVmdENvdW50OyBwKyspIHtcbiAgICAgICAgaWYgKCh0aGlzLmN1cnJlbnRQYWdlLXApID4gMCApIHtcbiAgICAgICAgICBsZWZ0QXJyLnB1c2godGhpcy5jdXJyZW50UGFnZS1wKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGxlZnRBcnIubGVuZ3RoIDwgbGVmdENvdW50KSB7XG4gICAgICAgIHJpZ2h0Q291bnQgKz0gbGVmdENvdW50LWxlZnRBcnIubGVuZ3RoOyBcbiAgICAgIH1cbiAgICAgIGZvciAobGV0IHA9MTsgcDw9cmlnaHRDb3VudDsgcCsrKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlK3AgPD0gdGhpcy50b3RhbFBhZ2UpIHtcbiAgICAgICAgICByaWdodEFyci5wdXNoKHRoaXMuY3VycmVudFBhZ2UrcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChyaWdodEFyci5sZW5ndGggPCByaWdodENvdW50KSB7XG4gICAgICAgIGxlZnRDb3VudCArPSByaWdodENvdW50IC0gcmlnaHRBcnIubGVuZ3RoICA7XG4gICAgICAgIGxlZnRBcnIgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgcD0xOyBwPD1sZWZ0Q291bnQ7IHArKykge1xuICAgICAgICAgIGlmICgodGhpcy5jdXJyZW50UGFnZS1wKSA+IDAgKSB7XG4gICAgICAgICAgICBsZWZ0QXJyLnB1c2godGhpcy5jdXJyZW50UGFnZS1wKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMucGFnZXMgPSB0aGlzLnBhZ2VzLmNvbmNhdChsZWZ0QXJyKTtcbiAgICAgIHRoaXMucGFnZXMgPSB0aGlzLnBhZ2VzLmNvbmNhdChyaWdodEFycik7XG4gICAgICBcbiAgICAgIHRoaXMucGFnZXMuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuXG4gIH1cblxuXG4gIHJlbmRlcmluZygpIHtcbiAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICB0aGlzLmNvbmZpZy5yZW5kZXIodGhpcy5jdXJyZW50UGFnZSk7XG4gICAgfSw1KVxuICB9XG59XG4iXX0=